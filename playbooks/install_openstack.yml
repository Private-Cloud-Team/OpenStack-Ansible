- name: Install haproxy
  hosts: ControllerNode
  user: vagrant
  roles:
    - { role: "haproxy_server", tags: [ "haproxy-server" ] }
  vars:
    internal_lb_vip_address: "{{ hostvars[groups['ControllerNode'][0]]['ansible_facts']['eth0']['ipv4']['address'] }}" 
    external_lb_vip_address: "{{ hostvars[groups['ControllerNode'][0]]['ansible_host'] }}"
    haproxy_service_configs:
      - service:
          haproxy_service_name: ControllerNode
          haproxy_backend_nodes: "{{ groups['ControllerNode'] }}"
          haproxy_backup_nodes: "{{ [] }}"
          haproxy_port: 80
          haproxy_balance_type: http
          haproxy_backend_options:
            - "forwardfor"
            - "httpchk"
            - "httplog"
          haproxy_backend_arguments:
            - 'http-check expect string OK'
  become: yes
- name: Install Galera server
  hosts: ControllerNode
  user: vagrant
  roles:
    - galera_server
  vars:
    galera_install_server: true
    galera_install_client: true
    galera_cluster_members: "{{ groups['ControllerNode'] }}"
    galera_root_password: secrete
  become: yes
